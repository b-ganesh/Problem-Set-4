---
title: "dim_reduction_hw"
author: "Bhargavi Ganesh"
date: "11/10/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(warn=-1)
library(psych) # for fa function
library(lattice)
library(scatterplot3d)
library(tidyverse)
library(ggfortify)
library(kableExtra)
library(factoextra)
library(sparsepca)
library(pcaMethods)
```

## Factor analysis

### Question 1: Factor Analysis is a set of techniques to figure out whether a latent factor (or factors) could account for covariation among a set of input features. In exploratory analysis, we go in without expectations on what the factor structure of the data would be, and find factor loadings for different numbers of factors. In confirmatory analysis, we have a pre-established theory on what number of factors there are and feature loadings should be. We see whether our results confirm these expectations.

## Question 2: Fitting exploratory factor analysis models initialized at 2, 3, and 4 factors.

Factor loading: coefficient relating latent variable to observed feature
Factor pattern matrix: matrix of factor loadings
Communality: amount of an observed variable's variance shared with other features
Uniqueness: amount of an observed variable's variance not shared with other features
Eigenvalue: captures amount of variance explained by each factor
Rotation: factor solutions only identified up to a rotation, meaning there are infinitely many solutions equally "good" in terms of variance explained.
Factor structure matrix: matrix of correlations between observed features and factors

Fit three exploratory factor analysis models initialized at 2, 3, and 4 factors. Present the loadings from these solutions and discuss in substantive terms. How does each fit? What sense does this give you of the underlying dimensionality of the space? And so on.

```{r load data}
countries <- read.csv(file.choose(), header = TRUE)
```

```{r factor analysis, warning=FALSE, message=FALSE}
factan.1 <- fa(countries[-1], 
               nfactors = 2)

factan.2 <- fa(countries[-1], 
               nfactors = 3)

factan.3 <- fa(countries[-1],
               nfactors = 4)
```

```{r inspecting first factor analysis}
summary(factan.1)
```

```{r inspecting first factor analysis2}
factan.1$loadings
```

```{r inspecting second factor analysis1}
summary(factan.2)
```

```{r inspecting second factor analysis2}
factan.2$loadings
```

```{r inspecting third factor analysis1}
summary(factan.3)
```

```{r inspecting third factor analysis2}
factan.3$loadings
```
### Question 3: 3-D plots

```{r nonrotated, warning=FALSE, message=FALSE}
nonrotated.factors <- fa(cor(countries[,-1]),
        fm = "pa", # communalities along the diagonal (total variation across features)
        nfactors = 3,
        rotate = "none",
        residuals = TRUE)

# Plot unrotated
s3d <- scatterplot3d(as.data.frame(unclass(nonrotated.factors$loadings)), main="3D factor loadings", color=1:ncol(countries[-1]), pch=20, type="h", angle=100)
s3d.coords <- s3d$xyz.convert((as.data.frame(unclass(nonrotated.factors$loadings))$PA1), (as.data.frame(unclass(nonrotated.factors$loadings))$PA2),(as.data.frame(unclass(nonrotated.factors$loadings))$PA3))
text(s3d.coords$x, s3d.coords$y,                         # x and y coordinates
          labels=colnames(countries[-1]),                # text to plot
          pos=4, cex=.5)

```

```{r rotated, warning=FALSE, message=FALSE}
# Orthogonal (varimax) rotated factor solution
varimax.factors <- fa(cor(countries[,-1]),
                      fm = "pa",
                      nfactors = 3,
                      rotate = "varimax",
                      smc = TRUE)

# Plot rotated
s3d <- scatterplot3d(as.data.frame(unclass(varimax.factors$loadings)), main="3D factor loadings", color=1:ncol(countries[-1]), pch=20, type="h", angle=100)
s3d.coords <- s3d$xyz.convert((as.data.frame(unclass(varimax.factors$loadings))$PA1), (as.data.frame(unclass(varimax.factors$loadings))$PA2),(as.data.frame(unclass(varimax.factors$loadings))$PA3))
text(s3d.coords$x, s3d.coords$y,                         # x and y coordinates
          labels=colnames(countries[-1]),                # text to plot
          pos=4, cex=.5)

```
## PCA

What is the statistical difference between PCA and FA? Describe the basic construction of each approach using equations and then point to differences that exist across these two widely used methods for reducing dimensionality.

```{r fitting PCA model}
pca1 <- prcomp(countries[-1],
               scale=TRUE,
               center = TRUE)
kable(as.data.frame(unclass(summary(pca1)$importance))[1:10])
```
### By visual inspection, it looks like 4 or 5 components would characterize the data. 
 
```{r PCA biplot}
fviz_pca_biplot(pca1, labelsize=3, repel=TRUE, label="var")
#need to add country names to this plot
```

### Sparse versus probabilistic PCA

```{r PCA sparse}
spca1 <- spca(countries[-1],
               scale=TRUE,
               center = TRUE)
```

```{r PCA probabilistic}
ppca1 <- pca(countries[-1], method="ppca")
```


#
# APPENDIX - variable list
#

#The full list of variables include:
#1. `idealpoint`: idealpoint preference based on UN votes, relative to US.
#2. `polity`: combined polity score, indicating regime type (autocatic<--->democratic)
#3. `polity2`: combined polity score 2, indicating regime type (autocatic<--->democratic)
#4. `democ`: Institutionalized Democracy
#5. `autoc`: Institutionalized Autocracy
#6. `unreg`: UN region 
#7. `physint`: CIRI physical integrity score (ciri)
#8. `speech`: CIRI freedom of speech score (ciri)
#9. `new_empinx`: CIRI Empowerment Rights Index (ciri)
#10. `wecon`: CIRI Women’s Economic Rights (ciri)
#11. `wepol`: CIRI Women’s Political Rights (ciri)
#12. `wosoc`: CIRI Women's Social Rights (ciri)
#13. `elecsd`: CIRI Electoral Self-Determination: (ciri)
#14. `gdp.pc.wdi`: GDP per capita, current US$ (World Bank Development Indicators)
#15. `gdp.pc.un`: GDP per capita, current US$ (UN data)
#16. `pop.wdi`: WDI population mid-year estimates (World Bank Development Indicators)
#17. `amnesty`: Political Terror Score measuring physical integrity rights violations worldwide, from Amnesty International
#18. `statedept`: Political Terror Score measuring physical integrity rights violations worldwide, from Amnesty International
#19. `milper`: Size of Military, (military personnel, thousands) from Correlates of War
#20. `cinc`: Composite Index of Military Capabilities from Correlates of War
#21. `domestic9`: Domestic Conflict / Stability Index, from Banks 2012
